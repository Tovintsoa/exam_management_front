<app-header-common></app-header-common>

<div class="p-8">
  <!-- En-tête avec titre et bouton -->
  <header class="flex justify-between items-center w-full mb-6 px-4">
    <div class="flex flex-col">
      <h1 class="text-2xl font-bold">Mes examens</h1>
      <p class="text-gray-600 mt-1" [attr.aria-live]="'polite'">
        <span *ngIf="nombreExam() > 0; else aucunExamen">{{ nombreExam() }} examens à venir sur  cette page</span>
        <ng-template #aucunExamen>
          <em>Aucun examen à venir</em>
        </ng-template>
      </p>
    </div>
    <button
      (click)="goToCreateExam()"
      class="px-4 py-2 rounded-lg bg-orange-500 hover:bg-orange-600 focus:ring-2 focus:ring-orange-300 focus:outline-none transition-colors text-white"
      aria-label="Organiser un nouvel examen">
      Organiser un examen
    </button>
  </header>

  <!-- Cartes de statistiques par statut -->
  <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8" aria-label="Statistiques des examens par statut">
    <div *ngFor="let statusItem of totalByStatus() | keyvalue; "
         class="flex flex-col justify-between p-4 border rounded-lg shadow-sm bg-white transition-shadow hover:shadow-md"
         [class]="statusMap[statusItem.key].borderColor"
         [attr.aria-label]="'Statut: ' + statusItem.key + ', Nombre: ' + statusItem.value">

      <!-- Label du statut -->
      <span class="text-sm font-medium text-gray-700">
        {{ statusItem.key }}
      </span>

      <!-- Container pour nombre et icône -->
      <div class="flex items-end justify-between mt-2">
        <span
          class="text-2xl font-bold"
          [class]="statusMap[statusItem.key].textColor">
          {{ statusItem.value }}
        </span>

        <!-- Icônes optimisées avec ngSwitch -->
        <ng-container [ngSwitch]="statusItem.key">
          <svg *ngSwitchCase="'Confirmé'"
               xmlns="http://www.w3.org/2000/svg"
               fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               class="w-6 h-6 text-green-600" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
          </svg>
          <svg *ngSwitchCase="'À organiser'"
               xmlns="http://www.w3.org/2000/svg"
               fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               class="w-6 h-6 text-orange-600" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
          </svg>
          <svg *ngSwitchCase="'Annulé'"
               xmlns="http://www.w3.org/2000/svg"
               fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               class="w-6 h-6 text-red-600" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
          <svg *ngSwitchCase="'En recherche de place'"
               xmlns="http://www.w3.org/2000/svg"
               fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               class="w-6 h-6 text-gray-600" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
          </svg>
        </ng-container>
      </div>
    </div>
  </section>

  <!-- Liste des examens -->
  <section class="space-y-4" aria-label="Liste des examens">
    <div *ngIf="exams().length === 0" class="text-center py-8 text-gray-500">
      <p>Aucun examen planifié pour le moment.</p>
    </div>

    <article *ngFor="let exam of exams();"
             class="card border border-gray-200 rounded-lg p-4 bg-white hover:shadow-md transition-shadow">
      <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-center">

        <!-- Nom de l'étudiant -->
        <div class="flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg"
               fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               class="w-5 h-5 text-gray-600 flex-shrink-0" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
          </svg>
          <span class="font-semibold text-gray-900 truncate">{{ exam.studentName }}</span>
        </div>

        <!-- Lieu -->
        <div class="flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg"
               fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               class="w-5 h-5 text-gray-600 flex-shrink-0" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
          </svg>
          <span *ngIf="exam.location?.trim(); else locationEnAttente"
                class="font-medium text-gray-700 truncate">{{ exam.location }}</span>
          <ng-template #locationEnAttente>
            <span class="italic text-gray-500">En attente</span>
          </ng-template>
        </div>

        <!-- Date -->
        <div class="flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg"
               fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               class="w-5 h-5 text-gray-600 flex-shrink-0" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 2.994v2.25m10.5-2.25v2.25m-14.252 13.5V7.491a2.25 2.25 0 0 1 2.25-2.25h13.5a2.25 2.25 0 0 1 2.25 2.25v11.251m-18 0a2.25 2.25 0 0 0 2.25 2.25h13.5a2.25 2.25 0 0 0 2.25-2.25m-18 0v-7.5a2.25 2.25 0 0 1 2.25-2.25h13.5a2.25 2.25 0 0 1 2.25 2.25v7.5m-6.75-6h2.25m-9 2.25h4.5m.002-2.25h.005v.006H12v-.006Zm-.001 4.5h.006v.006h-.006v-.005Zm-2.25.001h.005v.006H9.75v-.006Zm-2.25 0h.005v.005h-.006v-.005Zm6.75-2.247h.005v.005h-.005v-.005Zm0 2.247h.006v.006h-.006v-.006Zm2.25-2.248h.006V15H16.5v-.005Z" />
          </svg>
          <span *ngIf="exam.date?.trim(); else dateEnAttente"
                class="font-medium text-gray-700">{{ exam.date | date:'d MMM' }}</span>
          <ng-template #dateEnAttente>
            <span class="italic text-gray-500">En attente</span>
          </ng-template>
        </div>

        <!-- Heure -->
        <div class="flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg"
               fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               class="w-5 h-5 text-gray-600 flex-shrink-0" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
          </svg>
          <span *ngIf="exam.time?.trim(); else timeEnAttente"
                class="font-medium text-gray-700">{{ exam.time | date:'HH\'h\'mm':'UTC' }}</span>
          <ng-template #timeEnAttente>
            <span class="italic text-gray-500">En attente</span>
          </ng-template>
        </div>

        <!-- Badge de statut -->
        <div class="flex justify-start md:justify-end">
          <span
            class="inline-flex items-center border px-3 py-1 rounded-full text-sm font-medium transition-colors"
            [class]="statusMap[exam.status].textColor + ' ' + statusMap[exam.status].borderColor">

            <!-- Icône du statut -->
            <ng-container [ngSwitch]="exam.status">
              <svg *ngSwitchCase="'Confirmé'"
                   xmlns="http://www.w3.org/2000/svg"
                   fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                   class="w-4 h-4 mr-1.5 text-green-600" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
              </svg>
              <svg *ngSwitchCase="'À organiser'"
                   xmlns="http://www.w3.org/2000/svg"
                   fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                   class="w-4 h-4 mr-1.5 text-orange-600" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
              </svg>
              <svg *ngSwitchCase="'Annulé'"
                   xmlns="http://www.w3.org/2000/svg"
                   fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                   class="w-4 h-4 mr-1.5 text-red-600" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
              <svg *ngSwitchCase="'En recherche de place'"
                   xmlns="http://www.w3.org/2000/svg"
                   fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                   class="w-4 h-4 mr-1.5 text-gray-600" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
              </svg>
            </ng-container>

            <span>{{ statusMap[exam.status].label || 'Inconnu' }}</span>
          </span>
        </div>
      </div>
    </article>
  </section>
</div>
